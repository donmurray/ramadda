<?xml version="1.0" encoding="UTF-8"?>

<project basedir="." default="ramadda" name="RAMADDA">

    <target name="init">
        <property name="distdir" value="${basedir}/dist"/>
        <mkdir dir="${distdir}"/>


        <property name="dist_javadoc" value="${distdir}/javadoc"/>
        <mkdir dir="${dist_javadoc}"/>


        <property name="lib" value="${basedir}/lib"/>
        <property name="srcdir" value="${basedir}/src"/>
        <property name="classpath" value="${lib}/servlet-api.jar:${lib}/unidatacommon.jar:${lib}/idv.jar"/>
        <property  name="build.sysclasspath" value="ignore"/>

    </target>



    <target name="commoninit">
      <mkdir dir="${distdir}"/>
    </target>


    <target name="all" depends="init">
      <antcall target="plugins"/>
      <antcall target="ramadda"/>
    </target>


    <target name="ramadda" depends="init">
      <echo message="Building RAMADDA"/>
      <ant antfile="${srcdir}/org/ramadda/repository/build.xml" inheritAll="false"/>
    </target>

    <target name="plugins" depends="init">
      <ant antfile="${srcdir}/org/ramadda/plugins/build.xml" inheritAll="false"/>
      <ant antfile="${srcdir}/org/ramadda/geodata/build.xml" inheritAll="false"/>
   </target>



    <target name="pluginclean">
      <delete>
          <fileset dir="${srcdir}/${plugindir}" includes="**/*.class"/>
      </delete>
    </target>


    <target name="plugin" depends="init,pluginclean">
        <property name="plugindestdir" value="${distdir}/plugins"/>
        <mkdir dir="${plugindestdir}"/>
        <javac
            classpath="${classpath}"
            verbose="false"
            debug="true"
            deprecation="false" 
            nowarn="true"
            srcdir="${srcdir}"
            destdir="${srcdir}"
            failonerror="${javac.failonerror}"
            fork="${javac.fork}"
            memoryMaximumSize="${javac.maxmemory}"
            target="1.5">
        <include name="${plugindir}/*.java"/>
        </javac>

        <echo message="Making jar ${plugindestdir}/${jarfile}"/>
        <jar 
            basedir="${srcdir}"
            update="false"
            compress="true"
            jarfile="${plugindestdir}/${jarfile}">
            <include name="${plugindir}/**/*.class"/>
            <include name="${plugindir}/htdocs/**/*"/>
            <include name="${plugindir}/resources/**/*"/>
            <include name="${plugindir}/*.xml"/>
            <include name="${plugindir}/*.properties"/>
	    </jar>
    </target>



    <target name="pluginnocode" depends="init,pluginclean">
        <property name="plugindestdir" value="${distdir}/plugins"/>
        <mkdir dir="${plugindestdir}"/>
        <echo message="Making jar ${plugindestdir}/${jarfile}"/>
        <jar 
            basedir="${srcdir}"
            update="false"
            compress="true"
            jarfile="${plugindestdir}/${jarfile}">
            <include name="${plugindir}/htdocs/**/*"/>
            <include name="${plugindir}/resources/**/*"/>
            <include name="${plugindir}/*.xml"/>
            <include name="${plugindir}/*.properties"/>
	    </jar>
    </target>



    <target name="plugin_install">
        <property name="plugindestdir" value="${distdir}/plugins"/>
        <mkdir dir="${plugindestdir}"/>
        <copy overwrite="true"  todir="${user.home}/.ramadda/plugins">
             <fileset file="${plugindestdir}/${jarfile}"/>
        </copy>
    </target>




   <target name="clean" depends="init" >
        <delete>
            <fileset dir="${srcdir}/org" includes="**/*.class"/>
        </delete>
    </target>


   <target name="purge" depends="init,clean" >
     <delete dir="${distdir}"/>
    </target>





    <target name="javadoc" depends="init">
        <javadoc
            Author="true"
            Doctitle="RAMADDA"
            Use="true"
            Version="true" 
            Windowtitle="RAMADDA"
            classpath="${classpath}"
            destdir="${dist_javadoc}"
            maxmemory="512m"
            sourcepath="${srcdir}"
                 >
            <link href="http://java.sun.com/javase/6/docs/api/"/>
            <package name="org.ramadda.repository.*"/>
<!--
            <excludepackage name="org.unavco.???"/>
-->
        </javadoc>
    </target>



</project>
